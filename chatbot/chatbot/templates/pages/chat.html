{% extends "base.html" %}
{% load static %}

{% block title %}Chat with Bot{% endblock %}

{% block content %}
<h1>Chat with Bot</h1>
<div id="chat-box">
    <form id="chat-form" method="POST">
        {% csrf_token %}
        <div id="messages" class="mb-3">
            {% for message in messages %}
                <div><strong>User:</strong> {{ message.user_message }}</div>
                <div><strong>Bot:</strong> {{ message.bot_response }}</div>
            {% endfor %}
        </div>
        <input type="text" id="user-input" name="message" class="form-control mb-2" placeholder="Type your message..." required>
        <button type="button" id="send-button" class="btn btn-primary">Send</button>
    </form>
</div>
{% endblock content %}

{% block inline_javascript %}
<script>
    $(document).ready(function() {
        $('#send-button').click(function() {
            var message = $('#user-input').val();

            // Check if the message is not empty
            if (message.trim() === '') {
                return; // Do nothing if message is empty
            }

            // Append the user message to the chat
            $('#messages').append('<div><strong>User:</strong> ' + message + '</div>');

            // Make an AJAX POST request to submit the message
            $.post("{% url 'app:chat' %}", {
                message: message,
                csrfmiddlewaretoken: '{{ csrf_token }}' // Include CSRF token
            }, function(data) {
                $('#messages').append('<div><strong>Bot:</strong> ' + data.response + '</div>');
                $('#user-input').val(''); // Clear the input field
            }).fail(function() {
                $('#messages').append('<div><strong>Bot:</strong> Error processing your request.</div>');
            });
        });

        $('#chat-form').on('submit', function(event) {
            event.preventDefault(); // Prevent the default form submission
            $('#send-button').click(); // Trigger the click event on the button
        });
    });
</script>
{% endblock inline_javascript %}
